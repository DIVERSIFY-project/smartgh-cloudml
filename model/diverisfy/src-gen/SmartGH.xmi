<?xml version="1.0" encoding="ASCII"?>
<net.cloudml.core:CloudMLModel xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:net.cloudml.core="http://cloudml.net/core" name="SmartGH">
  <providers name="minicloud" credentials="C:/temp/credentialsOpenstack">
    <properties name="endPoint" value="https://api.sd1.flexiant.net:4442/userapi"/>
  </providers>
  <internalComponents name="SensorProcessor">
    <resources name="DockerImage" downloadCommand="sudo docker pull songhui/smartgh"/>
    <requiredPorts name="redisReq" component="//@internalComponents.0"/>
    <requiredExecutionPlatform name="ubuntuReq" owner="//@internalComponents.0">
      <demands name="OS" value="Ubuntu/docker"/>
    </requiredExecutionPlatform>
  </internalComponents>
  <internalComponents name="Hopper">
    <resources name="DockerImage" downloadCommand="sudo docker pull songhui/smartgh" startCommand="sudo cd /var/@instance{name}; echo &quot;./graphhopper.sh web ./maps/dublin-m50.osm&quot; >> run.sh; sudo docker run -i -t -v /var/@instance{name}/run.sh:/opt/gh/run.sh songhui/smartgh:updated-redis-url /bin/bash /opt/gh/run.sh"/>
    <requiredPorts name="redisReq" component="//@internalComponents.1"/>
    <requiredExecutionPlatform name="ubuntuReq" owner="//@internalComponents.1">
      <demands name="OS" value="Ubuntu/docker"/>
    </requiredExecutionPlatform>
  </internalComponents>
  <internalComponents name="RedisDB">
    <resources name="DockerImage" downloadCommand="sudo docker run -d -p 6379:6379 redis"/>
    <providedPorts name="redisPrv" component="//@internalComponents.2"/>
    <requiredExecutionPlatform name="ubuntuReq" owner="//@internalComponents.2">
      <demands name="OS" value="Ubuntu/docker"/>
    </requiredExecutionPlatform>
  </internalComponents>
  <vms name="OpenstackMedum" provider="//@providers.0" Region="RegionOne" maxRam="4000" maxCores="1" maxStorage="20" os="ubuntu" imageId="RegionOne/69df9b62-0549-4fce-9ef6-3eb06f34eee8" privateKey="mcuser.pem" groupName="diversify">
    <providedExecutionPlatforms name="ubuntuPrv" owner="//@vms.0">
      <offers name="OS" value="Ubuntu"/>
    </providedExecutionPlatforms>
  </vms>
  <relationships name="Redis2Sensors" requiredPort="//@internalComponents.1/@requiredPorts.0" providedPort="//@internalComponents.2/@providedPorts.0">
    <resources name="DockerRun" downloadCommand="wget -P ~ http://cloudml.org/scripts/linux/ubuntu/config-gh-launcher.sh" installCommand="sudo cp ~/config-gh-launcher.sh /var/@instance{requiredEnd/owner/value/name}/; cd /var/@instance{requiredEnd/owner/value/name}; sudo bash config-gh-launcher.sh"/>
  </relationships>
  <relationships name="Redis2Sensors" requiredPort="//@internalComponents.0/@requiredPorts.0" providedPort="//@internalComponents.2/@providedPorts.0"/>
</net.cloudml.core:CloudMLModel>
